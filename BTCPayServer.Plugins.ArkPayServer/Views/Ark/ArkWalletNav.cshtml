
@using BTCPayServer
@using BTCPayServer.Abstractions.Extensions
@using BTCPayServer.Data
@using BTCPayServer.Plugins.ArkPayServer
@using BTCPayServer.Plugins.ArkPayServer.PaymentHandler
@using BTCPayServer.Services.Invoices
@using BTCPayServer.Views.Stores
@model BTCPayServer.Components.MainNav.MainNavViewModel
@inject PaymentMethodHandlerDictionary HandlerDictionary 
@{
    var config =
        Context
        .GetStoreData()
        .GetPaymentMethodConfig<ArkadePaymentMethodConfig>(
            ArkadePlugin.ArkadePaymentMethodId,
            HandlerDictionary,
            true
        );
    var enabled = !string.IsNullOrEmpty(config?.WalletId);
}

<li class="nav-item">
    <a asp-area="" asp-controller="Ark" asp-action="@(enabled ? "StoreOverview" : "InitialSetup")"
       asp-route-storeId="@Model.Store.Id"
       class="nav-link @ViewData.ActivePageClass("Ark", nameof(StoreNavPages))"
       id="StoreNav-Ark">
        <span class="me-2 btcpay-status btcpay-status--@(enabled ? "enabled" : "pending")"></span>
        <span>Arkade</span>
    </a>

    @if (ViewData.IsCategoryActive("Ark"))
    {
        @if (!enabled) {
            <li class="nav-item nav-item-sub">
                <a id="StoreNav-InitialSetup"
                class="nav-link @ViewData.ActivePageClass("InitialSetup", "Ark")"
                asp-controller="Ark"
                asp-action="InitialSetup"
                asp-route-storeId="@Model.Store.Id"
                ext-translate="true">Getting Started</a>
            </li>
        }
        else {
            <li class="nav-item nav-item-sub">
                <a id="StoreNav-Overview"
                class="nav-link @ViewData.ActivePageClass("StoreOverview", "Ark")"
                asp-controller="Ark"
                asp-action="StoreOverview"
                asp-route-storeId="@Model.Store.Id"
                ext-translate="true">Overview</a>
            </li>
            <li class="nav-item nav-item-sub">
                <a id="StoreNav-Contracts"
                class="nav-link @ViewData.ActivePageClass("Contracts", "Ark")"
                asp-controller="Ark"
                asp-action="Contracts"
                asp-route-storeId="@Model.Store.Id"
                ext-translate="true">Contracts</a>
            </li>
            @if (config?.GeneratedByStore is true){
                 <li class="nav-item nav-item-sub">
                    <a id="StoreNav-SpendOverview"
                    class="nav-link @ViewData.ActivePageClass("SpendOverview", "Ark")"
                    asp-controller="Ark"
                    asp-action="SpendOverview"
                    asp-route-storeId="@Model.Store.Id"
                    ext-translate="true">Transfer</a>
                </li>
            }
        }
    }

</li>
